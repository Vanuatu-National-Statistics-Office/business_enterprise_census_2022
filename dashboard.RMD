---
title: "BEC 2022"
output: 
  flexdashboard::flex_dashboard:
    orientation: columns
    vertical_layout: scroll
    bootswatch: cosmo
---

```{r setup, include=FALSE}
library(flexdashboard)
library(dplyr) #Data manipulation
library(readxl) #read in Excel files
library(RSQLite) #SQLite data connection
library(haven)
library(susoapi)
library(ggplot2)
library(shiny)
library(readr)
```

```{r Connect to the SQLite database}

repository <- file.path(dirname(rstudioapi::getSourceEditorContext()$path))
setwd(repository)

conn <- dbConnect(RSQLite::SQLite(), "data/secure/sqlite/bec2022_monitor.sqlite")

```



Dashboard
=======================================================================


Column {data-width=650}
-----------------------------------------------------------------------

### Chart A Collections by Province

```{r}

error_chk <- dbGetQuery(conn, "SELECT interview__key, COUNT(interview__key) as totError FROM errors GROUP BY interview__key")
interviewer <- interview_actions %>% distinct(interview__key, originator, .keep_all = TRUE)

interviewer_error <- merge(error_chk, interviewer, by = "interview__key")

p<-ggplot(interviewer_error, aes(x=originator, y=totError, fill=totError)) +
  geom_bar(stat="identity")+theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, vjust = 0.5, hjust=1))
p

```


Column {data-width=350}
-----------------------------------------------------------------------

### Chart B: Distribution of Errors by Variable

```{r}

errors_detect <- dbGetQuery(conn, "SELECT variable, COUNT(interview__key) AS total FROM errors GROUP BY variable ")

p<-ggplot(errors_detect, aes(x=variable, y=total, fill=total)) +
  geom_bar(stat="identity")+theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, vjust = 0.5, hjust=1))
p

```

### Chart C: Distribution of Errors by Interviewer

```{r}


province <- read.csv("data/open/province.csv")
prov <- dbGetQuery(conn, "SELECT province, COUNT(interview__key) AS total FROM main WHERE province > 0 GROUP BY province")

prov_results <- merge(prov, province, by = "province")

p<-ggplot(prov_results, aes(x=province_desc, y=total, fill=total)) +
  geom_bar(stat="identity")+theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, vjust = 0.5, hjust=1))
p


```

Industry Reporting
======================================================================

### Error Reporting by Variable

```{r}


```


Error Reporting Page
=======================================================================

Column {.sidebar}
------------------------------------------------------------------
```{r}


```


column
-------------------------------------------------------------------
### Display 

```{r}



```





User actions Reporting
=======================================================================

```{r Disconnect database}

dbDisconnect(conn)

```